<!DOCTYPE html>
<html lang="my">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>UBT Reading Exam</title>
    <style>
        :root { --main-blue: #00b4db; --dark-bg: #1a233a; --light-bg: #f0f2f5; }
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; margin: 0; background: var(--dark-bg); color: #333; -webkit-user-select: none; }
        
        /* Header Bar - ပုံထဲကအတိုင်း */
        .header { background: var(--dark-bg); color: white; padding: 12px 15px; display: flex; justify-content: space-between; align-items: center; border-bottom: 2px solid #333; }
        .timer-box { background: #ff0055; color: white; padding: 5px 15px; border-radius: 5px; font-weight: bold; font-size: 1.2rem; }

        /* Exam Container */
        #exam-page { display: none; background: var(--light-bg); min-height: 100vh; flex-direction: column; }
        .main-content { flex: 1; padding: 15px; overflow-y: auto; }

        /* Question Card - အဖြူရောင်ဘောင်ဝိုင်း */
        .q-card { background: white; border-radius: 15px; padding: 20px; box-shadow: 0 4px 10px rgba(0,0,0,0.1); border-top: 5px solid var(--main-blue); margin-bottom: 20px; }
        #q-no { color: var(--main-blue); font-weight: bold; font-size: 1.1rem; margin-bottom: 10px; }
        #q-text { font-size: 1.1rem; line-height: 1.6; margin-bottom: 15px; }

        /* ပုံမဝါးအောင် ပြင်ဆင်ချက် */
        #q-img { width: 100%; max-width: 500px; display: none; margin: 15px auto; border-radius: 10px; border: 1px solid #ddd; image-rendering: -webkit-optimize-contrast; object-fit: contain; }

        /* Options - ပုံစံတူ */
        .opt-btn { background: white; border: 1px solid #ddd; padding: 15px; border-radius: 12px; display: flex; align-items: center; margin-bottom: 12px; cursor: pointer; transition: 0.2s; }
        .opt-num { width: 35px; height: 35px; border: 1px solid #ddd; border-radius: 50%; display: flex; justify-content: center; align-items: center; margin-right: 15px; font-weight: bold; color: #666; }
        .opt-btn.active { border: 2px solid var(--main-blue); background: #e1f5fe; }
        .opt-btn.active .opt-num { background: var(--main-blue); color: white; border: none; }

        /* Bottom Nav */
        .footer-nav { background: #0c1221; padding: 15px; display: grid; grid-template-columns: 1fr 1fr 1fr 1.2fr; gap: 8px; }
        .nav-btn { background: #333; color: white; border: none; padding: 12px; border-radius: 5px; font-weight: bold; cursor: pointer; }
        .finish-btn { background: #ff0055; color: white; }

        /* Palette Box */
        .palette { display: grid; grid-template-columns: repeat(5, 1fr); gap: 6px; padding: 15px; background: white; border-radius: 10px; }
        .p-item { padding: 10px; border: 1px solid #ccc; text-align: center; border-radius: 4px; font-size: 0.9rem; }
        .p-item.done { background: #2ecc71; color: white; border: none; }
    </style>
</head>
<body>

<div id="login" style="padding: 50px 20px; text-align: center;">
    <h2 style="color:white;">UBT EXAM LOGIN</h2>
    <input type="text" id="user-name" placeholder="သင့်နာမည်ရိုက်ပါ" style="width:85%; padding:15px; border-radius:8px; border:none; margin-bottom:15px;">
    <button onclick="start()" style="width:85%; padding:15px; background:var(--main-blue); color:white; border:none; border-radius:8px; font-weight:bold;">LOGIN & START</button>
</div>

<div id="exam-page">
    <div class="header">
        <span id="display-name" style="font-weight:bold;">Name</span>
        <div class="timer-box" id="timer">20:00</div>
    </div>
    
    <div class="main-content">
        <div class="q-card">
            <div id="q-no"></div>
            <div id="q-text"></div>
            <img id="q-img" src="">
        </div>
        <div id="options"></div>
        <div class="palette" id="palette"></div>
    </div>

    <div class="footer-nav">
        <button class="nav-btn" onclick="move(-1)">PREVIOUS</button>
        <button class="nav-btn" style="background:#00b4db;">LIST</button>
        <button class="nav-btn" onclick="move(1)">NEXT</button>
        <button class="nav-btn finish-btn" onclick="finish()">FINISH</button>
    </div>
</div>

<script>
    let questions = [], answers = [], current = 0, timeLeft = 20 * 60;
    const apiURL = "https://script.google.com/macros/s/AKfycbycLVJ64q_BiSIVvsugR4pFn0tk8tkaS-agzwICHSbMOK0dNtw5-ZgLe-H5lMaU9Gax8w/exec"; // <--- Apps Script URL

    async function start() {
        const name = document.getElementById('user-name').value;
        if(!name) return alert("နာမည်ထည့်ပါ");
        document.getElementById('display-name').innerText = "Candidate: " + name;
        document.getElementById('login').innerHTML = "<h3 style='color:white;'>LOADING...</h3>";
        
        try {
            const res = await fetch(apiURL);
            questions = await res.json();
            answers = new Array(questions.length).fill(null);
            document.getElementById('login').style.display = 'none';
            document.getElementById('exam-page').style.display = 'flex';
            showQ();
            startTimer(); // Timer စတင်ခြင်း
        } catch(e) { alert("Error: Web App URL ကို စစ်ဆေးပါ"); }
    }

    function startTimer() {
        const timerEl = document.getElementById('timer');
        const itv = setInterval(() => {
            let min = Math.floor(timeLeft / 60);
            let sec = timeLeft % 60;
            timerEl.innerText = `${min}:${sec < 10 ? '0' : ''}${sec}`;
            if(timeLeft <= 0) { clearInterval(itv); finish(); }
            timeLeft--;
        }, 1000);
    }

    function showQ() {
        const q = questions[current];
        document.getElementById('q-no').innerText = `[Question ${current + 1}]`;
        document.getElementById('q-text').innerText = q.text;
        const img = document.getElementById('q-img');
        if(q.img) { img.src = q.img; img.style.display = 'block'; } else { img.style.display = 'none'; }
        
        const optArea = document.getElementById('options');
        optArea.innerHTML = "";
        q.options.forEach((opt, i) => {
            const active = answers[current] === i;
            optArea.innerHTML += `<div class="opt-btn ${active?'active':''}" onclick="hit(${i})">
                <div class="opt-num">${i+1}</div>${opt}</div>`;
        });
        drawPalette();
    }

    function hit(i) { answers[current] = i; showQ(); }
    function move(s) { current += s; if(current >= 0 && current < questions.length) showQ(); }
    
    function drawPalette() {
        const p = document.getElementById('palette');
        p.innerHTML = "";
        questions.forEach((_, i) => {
            p.innerHTML += `<div class="p-item ${answers[i]!==null?'done':''}" onclick="current=${i};showQ()">${i+1}</div>`;
        });
    }

    function finish() {
        if(confirm("Exam အဆုံးသတ်မှာလား?")) {
            // အဖြေသိမ်းဆည်းသည့်အပိုင်း (ယခင်ပေးထားသည့်အတိုင်း)
            alert("စာမေးပွဲပြီးပါပြီ။ Result ကို စစ်ဆေးနိုင်ပါပြီ။");
            location.reload();
        }
    }
</script>
</body>
    </html>
