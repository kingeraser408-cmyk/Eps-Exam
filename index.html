<script>
    const questions = [
        {
            type: "reading_img",
            text: "ë‹¤ìŒ ê·¸ë¦¼ì„ ë³´ê³  ë§ëŠ” ë‹¨ì–´ë‚˜ ë¬¸ì¥ì„ ê³ ë¥´ì‹­ì‹œì˜¤.",
            img: "q1.jpg", 
            audio: "",
            options: ["ë¹„ëŠ˜ë´‰íˆ¬ì— ë¬¼ê±´ì„ ê°€ë“ ë‹´ê³  ìˆìŠµë‹ˆë‹¤.", "ì¢…ì´ ë°•ìŠ¤ë¥¼ í…Œì´í”„ë¡œ í¬ì¥í•˜ê³  ìˆìŠµë‹ˆë‹¤.", "í™˜ê²½ ë³´í˜¸ë¥¼ ìœ„í•´ ì¥ë°”êµ¬ë‹ˆë¥¼ ì‚¬ìš©í•©ë‹ˆë‹¤.", "ì¼íšŒìš© ì»µì— ë‹´ê¸´ ì»¤í”¼ë¥¼ ë§ˆì‹œê³  ìˆìŠµë‹ˆë‹¤."],
            ans: 2
        }
        // á€”á€±á€¬á€€á€ºá€‘á€•á€º á€™á€±á€¸á€á€½á€”á€ºá€¸á€™á€»á€¬á€¸ á€’á€®á€™á€¾á€¬ á€†á€€á€ºá€‘á€Šá€·á€ºá€•á€«
    ];

    let currentIdx = 0;
    let selectedAnswers = new Array(questions.length).fill(null); // á€€á€»á€±á€¬á€„á€ºá€¸á€á€¬á€¸ á€›á€½á€±á€¸á€‘á€¬á€¸á€á€¬á€á€½á€± á€á€­á€™á€ºá€¸á€–á€­á€¯á€·
    let timeLeft = 20 * 60; // á€™á€­á€”á€…á€º á‚á€ (á€…á€€á€¹á€€á€”á€·á€ºá€–á€¼á€„á€·á€º)
    let timerInterval;

    function startExam() {
        document.getElementById('login-page').style.display = 'none';
        document.getElementById('exam-page').style.display = 'flex';
        loadQuestion();
        startTimer(); // Timer á€…á€á€„á€ºá€á€¼á€„á€ºá€¸
    }

    // áá‹ Auto-Submit Timer á€…á€”á€…á€º
    function startTimer() {
        timerInterval = setInterval(() => {
            let mins = Math.floor(timeLeft / 60);
            let secs = timeLeft % 60;
            document.getElementById('timer').innerText = `REM:${mins}:${secs < 10 ? '0' : ''}${secs}`;
            
            if (timeLeft <= 0) {
                clearInterval(timerInterval);
                autoSubmit(); // á€¡á€á€»á€­á€”á€ºá€•á€¼á€Šá€·á€ºá€›á€„á€º á€¡á€œá€­á€¯á€¡á€œá€»á€±á€¬á€€á€º á€á€„á€ºá€™á€Šá€º
            }
            timeLeft--;
        }, 1000);
    }

    function loadQuestion() {
        const q = questions[currentIdx];
        document.getElementById('q-number').innerText = `[Question ${currentIdx + 1}]`;
        document.getElementById('q-text').innerText = q.text;
        
        const imgTag = document.getElementById('q-img');
        imgTag.src = q.img;
        imgTag.style.display = q.img ? 'block' : 'none';

        const audioTag = document.getElementById('q-audio');
        audioTag.src = q.audio;
        audioTag.style.display = q.audio ? 'block' : 'none';

        const optDiv = document.getElementById('options');
        optDiv.innerHTML = "";
        
        q.options.forEach((opt, i) => {
            // á‚á‹ Selection Highlight á€…á€”á€…á€º (á€›á€½á€±á€¸á€‘á€¬á€¸á€á€²á€· á€¡á€–á€¼á€±á€€á€­á€¯ á€¡á€›á€±á€¬á€„á€ºá€•á€¼á€±á€¬á€„á€ºá€¸á€‘á€¬á€¸á€á€¼á€„á€ºá€¸)
            const isSelected = selectedAnswers[currentIdx] === i;
            const highlightStyle = isSelected ? 'style="background: #e1f5fe; border: 2px solid #00b4db;"' : '';
            const numCircleStyle = isSelected ? 'style="background: #00b4db; color: white; border-color: #00b4db;"' : '';

            optDiv.innerHTML += `
                <div class="opt-btn" onclick="selectOpt(${i})" ${highlightStyle}>
                    <div class="opt-num" ${numCircleStyle}>${i+1}</div>
                    <div>${opt}</div>
                </div>`;
        });
    }

    function selectOpt(idx) {
        selectedAnswers[currentIdx] = idx; // á€›á€½á€±á€¸á€á€»á€šá€ºá€™á€¾á€¯á€€á€­á€¯ á€™á€¾á€á€ºá€á€¬á€¸á€‘á€¬á€¸á€á€¼á€„á€ºá€¸
        loadQuestion(); // UI á€€á€­á€¯ Refresh á€œá€¯á€•á€ºá€•á€¼á€®á€¸ á€¡á€›á€±á€¬á€„á€ºá€•á€¼á€±á€¬á€„á€ºá€¸á€…á€±á€á€¼á€„á€ºá€¸
    }

    function nextQ() { if(currentIdx < questions.length - 1) { currentIdx++; loadQuestion(); } }
    function prevQ() { if(currentIdx > 0) { currentIdx--; loadQuestion(); } }

    function autoSubmit() {
        alert("á€¡á€á€»á€­á€”á€ºá€•á€¼á€Šá€·á€ºá€á€½á€¬á€¸á€•á€«á€•á€¼á€®á‹ á€¡á€–á€¼á€±á€œá€½á€¾á€¬á€€á€­á€¯ á€¡á€œá€­á€¯á€¡á€œá€»á€±á€¬á€€á€º á€•á€±á€¸á€•á€­á€¯á€·á€œá€­á€¯á€€á€ºá€•á€«á€•á€¼á€®á‹");
        finishExam();
    }

    function finishExam() {
        // á€¡á€™á€¾á€á€ºá€á€½á€€á€ºá€á€»á€€á€ºá€á€¼á€„á€ºá€¸á€”á€¾á€„á€·á€º Result Page á€á€­á€¯á€·á€á€½á€¬á€¸á€á€¼á€„á€ºá€¸
        let finalScore = 0;
        selectedAnswers.forEach((ans, i) => {
            if(ans === questions[i].ans) finalScore += 5;
        });
        
        document.body.innerHTML = `
            <div style="background:#12192c; color:white; height:100vh; display:flex; flex-direction:column; align-items:center; justify-content:center; font-family:sans-serif;">
                <h1>Exam Completed</h1>
                <div style="font-size:100px;">ğŸ‰</div>
                <h2 style="color:#00b4db;">Your Score: ${finalScore} / ${questions.length * 5}</h2>
                <button onclick="location.reload()" style="background:#00b4db; color:white; border:none; padding:15px 30px; border-radius:10px; cursor:pointer; margin-top:20px;">BACK TO HOME</button>
            </div>
        `;
    }
</script>
